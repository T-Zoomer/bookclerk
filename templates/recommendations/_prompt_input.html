{% load static %}
<!-- Main Form Card -->
<div class="md:bg-cream md:rounded-xl md:shadow-2xl md:border md:border-burgundy-soft md:p-10 lg:p-8 xl:p-6 mb-6 md:mb-8 lg:mb-6 relative md:overflow-hidden">

    <!-- Vintage corners -->
    <div class="hidden md:block absolute top-4 left-4 w-6 h-6 border-l-2 border-t-2 border-gold/40"></div>
    <div class="hidden md:block absolute top-4 right-4 w-6 h-6 border-r-2 border-t-2 border-gold/40"></div>
    <div class="hidden md:block absolute bottom-4 left-4 w-6 h-6 border-l-2 border-b-2 border-gold/40"></div>
    <div class="hidden md:block absolute bottom-4 right-4 w-6 h-6 border-r-2 border-b-2 border-gold/40"></div>
    
    <div class="relative md:z-10">
        <!-- Mobile logo - centered above text -->
        <div class="flex justify-center md:hidden">
            <img src="{% static 'images/logo.png' %}" alt="BookClerk Logo" class="w-24 h-24 object-contain">
        </div>
        
        <div class="flex flex-col md:flex-row items-center justify-between mb-2 md:mb-8 lg:mb-6 xl:mb-4">
            <div class="hidden md:block">
                <img src="{% static 'images/logo.png' %}" alt="BookClerk Logo" class="w-32 h-32 object-contain">
            </div>
            <div class="flex justify-center text-center">
                <h2 class="text-2xl md:text-4xl font-serif font-semibold text-ink md:mb-3">What do you want to read?</h2>
            </div>
            <div class="hidden md:block w-32 h-32"></div>
        </div>
        
        <form method="post" action="{% url 'get_recommendations' %}" class="space-y-2 md:space-y-6 lg:space-y-4 xl:space-y-3" id="recommendation-form">
            {% csrf_token %}
            <div>
                
                <div class="relative">
                    <textarea 
                        id="preferences" 
                        name="preferences" 
                        rows="3" 
                        class="w-full px-4 md:px-6 py-4 md:py-6 border border-burgundy rounded bg-white focus:outline-none focus:ring-3 focus:ring-burgundy focus:border-burgundy focus:border-2 transition-all duration-200 font-serif text-lg md:text-xl text-ink placeholder-leather/60 resize-none overflow-hidden"
                        placeholder=""
                        data-placeholder="I like science fiction with strong characters, mysteries set in small towns, or psychology books. Include genres, authors, or specific books you've enjoyed."
                        required
                        oninput="autoResize(this)"
                    ></textarea>
                    <!-- Decorative quill icon -->
                    <div class="absolute bottom-3 right-3 text-gold/40 pointer-events-none">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z"/>
                            <path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd"/>
                        </svg>
                    </div>
                </div>
            </div>
            
            <div class="flex justify-between items-center">
                {% if recent_requests %}
                <button type="button" id="view-recent-btn" class="text-burgundy/70 hover:text-burgundy transition-colors text-sm md:text-base font-serif flex items-center space-x-1 group">
                    <svg class="w-4 h-4 group-hover:rotate-12 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    <span>Recent recommendations</span>
                </button>
                {% else %}
                <div></div>
                {% endif %}
                <div>
                    {% include 'recommendations/_recommendation_button.html' with button_type='submit' button_id='submit-btn' button_text='Discover Books' show_loading=True loading_text='Finding perfect books...' %}
                </div>
            </div>
        </form>
    </div>
</div>

<script>
function autoResize(textarea) {
    // Reset height to get accurate scrollHeight
    textarea.style.height = 'auto';
    
    // Calculate the line height
    const lineHeight = parseInt(window.getComputedStyle(textarea).lineHeight);
    const minRows = 2;
    const maxRows = 10;
    
    // Calculate required rows based on scroll height
    const rows = Math.min(maxRows, Math.max(minRows, Math.ceil(textarea.scrollHeight / lineHeight)));
    
    // Set the height
    textarea.style.height = (rows * lineHeight) + 'px';
}

// Examples functionality
const examples = [
    "Non-fiction books on the future of artificial intelligence.",
    "Books like Harry Potter.",
    "Best literary fiction from Russian authors.",
    "I enjoy literary fiction with unreliable narrators and beautiful prose, especially books that explore themes of memory and identity.",
    "Mystery novels set in small towns.",
    "I'm interested in non-fiction about psychology and human behavior, particularly books that explain cognitive biases and decision-making.",
    "Science fiction books that are critically acclaimed but not well known.",
    "Romance books with strong female leads.",
    "I love fantasy novels with complex magic systems like Brandon Sanderson's works.",
    "Non-fiction about personal development.",
    "I'm looking for science fiction that explores social issues and dystopian futures, similar to Margaret Atwood or Ursula K. Le Guin."
];

let currentExampleIndex = Math.floor(Math.random() * examples.length);

function updateExample() {
    const textarea = document.getElementById('preferences');
    if (textarea && textarea.value === '') {
        textarea.placeholder = examples[currentExampleIndex];
    }
}

function nextExample() {
    currentExampleIndex = (currentExampleIndex + 1) % examples.length;
    updateExample();
}

// Initialize examples and auto-rotation
document.addEventListener('DOMContentLoaded', function() {
    const textarea = document.getElementById('preferences');
    if (textarea) {
        // Initialize autoResize
        autoResize(textarea);
        
        // Initialize examples
        updateExample();
        setInterval(nextExample, 4000); // Change example every 4 seconds
        
        // Clear auto-rotation when user starts typing
        textarea.addEventListener('input', function() {
            if (this.value !== '') {
                this.placeholder = this.dataset.placeholder;
            }
        });
        
        // Submit form when Enter is pressed (but allow Shift+Enter for new lines)
        textarea.addEventListener('keydown', function(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                const submitBtn = document.getElementById('submit-btn');
                if (submitBtn && this.value.trim() !== '') {
                    submitBtn.click();
                }
            }
        });
        
        textarea.addEventListener('blur', function() {
            if (this.value === '') {
                updateExample();
            }
        });
    }
    
    // View recent recommendations button
    const viewRecentBtn = document.getElementById('view-recent-btn');
    if (viewRecentBtn) {
        viewRecentBtn.addEventListener('click', function() {
            // Check if openRecentMenu function exists (from base.html)
            if (typeof openRecentMenu === 'function') {
                openRecentMenu();
            }
        });
    }
    
});
</script>
